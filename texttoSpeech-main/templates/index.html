<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Text to Speech + Translation</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f1f4f8;
      color: #333;
      margin: 0;
    }
    .navbar {
      background-color: #4e73df;
    }
    .navbar .navbar-brand {
      font-weight: 600;
      color: #fff !important;
    }
    .header-section {
      background: linear-gradient(to right, #4e73df, #1e3c72);
      color: white;
      padding: 80px 0;
      text-align: center;
      border-bottom: 5px solid #007bff;
    }
    .header-section h1 {
      font-size: 3rem;
      font-weight: 700;
    }
    .header-section p {
      font-size: 1.1rem;
      margin-top: 15px;
    }
    .container {
      padding-top: 40px;
      padding-bottom: 40px;
    }
    .form-section {
      background-color: #ffffff;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .form-section:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }
    .form-group label {
      font-weight: 600;
      font-size: 1.1rem;
    }
    .form-group textarea {
      border-radius: 8px;
      padding: 15px;
      font-size: 1rem;
      resize: none;
      border: 1px solid #ddd;
      width: 100%;
    }
    .form-group textarea:focus {
      border-color: #4e73df;
      outline: none;
    }
    .btn-primary {
      background-color: #4e73df;
      border: none;
      padding: 15px;
      border-radius: 6px;
      width: 100%;
      font-size: 1.2rem;
      font-weight: 600;
      transition: all 0.3s;
    }
    .btn-primary:hover {
      background-color: #2e59d9;
    }
    .result-section {
      background-color: #ffffff;
      padding: 30px;
      margin-top: 30px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
    }
    .result-section h5 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
    }
    .footer {
      background-color: #4e73df;
      color: white;
      padding: 20px 0;
      text-align: center;
      position: fixed;
      width: 100%;
      bottom: 0;
    }
    .loader {
      display: none;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #4e73df;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: auto;
      margin-top: 20%;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <span class="navbar-brand text-white">Text to Speech + Translation</span>
  </div>
</nav>

<!-- Header Section -->
<section class="header-section">
  <h1>Text to Speech Converter with Translation</h1>
  <p class="lead">Translate your text and convert it to speech with one click.</p>
</section>

<!-- Main Content -->
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6 col-12 form-section">
      <form id="datafetch_form">
        <div class="form-group">
          <label for="comment">Enter Text</label>
          <textarea class="form-control" id="comment" placeholder="Enter the text you want to translate and convert into speech"></textarea>
        </div>

        <div class="form-group">
          <label for="source_lang">Source Language</label>
          <select class="form-control" id="source_lang">
            <option value="auto" selected>Auto Detect</option>
          </select>
        </div>

        <div class="form-group">
          <label for="target_lang">Target Language</label>
          <select class="form-control" id="target_lang"></select>
        </div>

        <button type="submit" class="btn btn-primary" id="fetch">Translate & Convert to Speech</button>
      </form>
    </div>
  </div>
  <!-- Result Section -->
  <div class="row justify-content-center mt-5">
    <div class="col-md-6 col-12 result-section">
      <h5 class="text-center">Speech Result</h5>
      <div id="json-result" class="text-center"></div>
    </div>
  </div>
</div>

<hr>
<h4 class="text-center mt-5">üé§ Speech to Text</h4>
<div class="row justify-content-center">
  <div class="col-md-6 col-12 form-section">
    <div class="form-group text-center">
      <button class="btn btn-success" id="recordBtn">üéôÔ∏è Start Recording</button>
    </div>
    <div class="form-group">
      <label>Recognized Text:</label>
      <textarea class="form-control" id="recognizedText" rows="3" readonly></textarea>
    </div>
  </div>
</div>

<script>
let isRecording = false;
let mediaRecorder;
let audioChunks = [];
document.getElementById("recordBtn").addEventListener("click", async () => {
  if (!isRecording) {
    isRecording = true;
    document.getElementById("recordBtn").innerText = "üõë Stop Recording";

    audioChunks = []; // reset each recording
    let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream, { mimeType: "audio/webm" });
    mediaRecorder.start();

    mediaRecorder.ondataavailable = (e) => {
      audioChunks.push(e.data);
    };

    mediaRecorder.onstop = async () => {
      console.log("Chunks recorded:", audioChunks.length);
      const audioBlob = new Blob(audioChunks);
      const reader = new FileReader();
      reader.readAsDataURL(audioBlob);
      reader.onloadend = async () => {
        const base64Audio = reader.result.split(",")[1];
        const res = await fetch("/speechToText", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ audio: base64Audio })
        });
        const data = await res.json();
        document.getElementById("recognizedText").value = data.text || data.error;
      };
    };
  } else {
    isRecording = false;
    mediaRecorder.stop();
    document.getElementById("recordBtn").innerText = "üéôÔ∏è Start Recording";
  }
});

</script>


<!-- Loader -->
<div id="loading" class="loader"></div>

<!-- Footer -->
<footer class="footer">
  <p>&copy; 2025 Text to Speech + Translation Project. All Rights Reserved.</p>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script>
  $(document).ready(function() {
    $('#loading').hide();

    $("#datafetch_form").submit(function(e) {
      e.preventDefault();
      var input = $('#comment').val();
      var sourceLang = $('#source_lang').val();
      var targetLang = $('#target_lang').val();
      $('#loading').show();

      $.ajax({
        url: "/predict",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({ 
          data: input,
          source_lang: sourceLang,
          target_lang: targetLang
        }),
        success: function(response) {
          $('#loading').hide();
          var audioFile = "data:audio/mp3;base64," + response.data;
          var audioHTML = '<audio controls><source src="' + audioFile + '" type="audio/mp3">Your browser does not support the audio format.</audio>';
          $('#json-result').html(audioHTML);
        },
        error: function() {
          $('#loading').hide();
          alert('Error occurred. Please try again!');
        }
      });
    });
  });
</script>
<script>
const languages = {
  'af': 'Afrikaans','sq': 'Albanian','am': 'Amharic','ar': 'Arabic','hy': 'Armenian',
  'az': 'Azerbaijani','eu': 'Basque','be': 'Belarusian','bn': 'Bengali','bs': 'Bosnian',
  'bg': 'Bulgarian','ca': 'Catalan','ceb': 'Cebuano','ny': 'Chichewa','zh-cn': 'Chinese (Simplified)',
  'zh-tw': 'Chinese (Traditional)','co': 'Corsican','hr': 'Croatian','cs': 'Czech','da': 'Danish',
  'nl': 'Dutch','en': 'English','eo': 'Esperanto','et': 'Estonian','tl': 'Filipino','fi': 'Finnish',
  'fr': 'French','fy': 'Frisian','gl': 'Galician','ka': 'Georgian','de': 'German','el': 'Greek',
  'gu': 'Gujarati','ht': 'Haitian Creole','ha': 'Hausa','haw': 'Hawaiian','iw': 'Hebrew','hi': 'Hindi',
  'hmn': 'Hmong','hu': 'Hungarian','is': 'Icelandic','ig': 'Igbo','id': 'Indonesian','ga': 'Irish',
  'it': 'Italian','ja': 'Japanese','jw': 'Javanese','kn': 'Kannada','kk': 'Kazakh','km': 'Khmer',
  'rw': 'Kinyarwanda','ko': 'Korean','ku': 'Kurdish (Kurmanji)','ky': 'Kyrgyz','lo': 'Lao','la': 'Latin',
  'lv': 'Latvian','lt': 'Lithuanian','lb': 'Luxembourgish','mk': 'Macedonian','mg': 'Malagasy','ms': 'Malay',
  'ml': 'Malayalam','mt': 'Maltese','mi': 'Maori','mr': 'Marathi','mn': 'Mongolian','my': 'Myanmar (Burmese)',
  'ne': 'Nepali','no': 'Norwegian','or': 'Odia (Oriya)','ps': 'Pashto','fa': 'Persian','pl': 'Polish',
  'pt': 'Portuguese','pa': 'Punjabi','ro': 'Romanian','ru': 'Russian','sm': 'Samoan','gd': 'Scots Gaelic',
  'sr': 'Serbian','st': 'Sesotho','sn': 'Shona','sd': 'Sindhi','si': 'Sinhala','sk': 'Slovak','sl': 'Slovenian',
  'so': 'Somali','es': 'Spanish','su': 'Sundanese','sw': 'Swahili','sv': 'Swedish','tg': 'Tajik','ta': 'Tamil',
  'tt': 'Tatar','te': 'Telugu','th': 'Thai','tr': 'Turkish','tk': 'Turkmen','uk': 'Ukrainian','ur': 'Urdu',
  'ug': 'Uyghur','uz': 'Uzbek','vi': 'Vietnamese','cy': 'Welsh','xh': 'Xhosa','yi': 'Yiddish',
  'yo': 'Yoruba','zu': 'Zulu'
};

$(document).ready(function() {
  const sourceSelect = $('#source_lang');
  const targetSelect = $('#target_lang');
  for (const [code, name] of Object.entries(languages)) {
    sourceSelect.append(`<option value="${code}">${name}</option>`);
    targetSelect.append(`<option value="${code}">${name}</option>`);
  }
  // set defaults
  targetSelect.val('en');
});
</script>



</body>
</html>





